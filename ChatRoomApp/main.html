<!DOCTYPE html>
<html>
<head>
    <title>CHATROOM</title>
    <link rel="stylesheet" href="Style.css">
    <link rel="icon" type="image/x-icon" href="../sources/ico/flavico/favicon.ico">
</head>
<body>
<div id="app-container">
    <aside class="sidebar">
        <h2 id="title">CANAL GENERAL</h2>
        
        <div class="control-group">
            <h3>REJOINDRE UNE SALLE</h3>
            <form id="form2">
                <input id="room" autocomplete="off" placeholder="Nom de room..." />
                <button>Rejoindre</button>
            </form>
        </div>
        <div class="control-group">
            <h3>CHUCHOTER</h3>
            <form id="form4">
                <input id="nameInput" autocomplete="off" placeholder="ID Destinataire" />
                <input id="chuchoterInput" autocomplete="off" placeholder="Message..." />
                <button>Chuchoter</button>
            </form>
            <h3>ANNONCES</h3>
            <form id="form3">
                <input id="publicMessage" autocomplete="off" placeholder="Code + Message..." />
                <button>Public</button>
            </form>
        </div>
    </aside>

    <main class="chat-area">
        <ul id="messages"></ul>
            <form id="form" class="message-input-bar">
                <input id="input" autocomplete="off" placeholder="Ã‰crire dans la salle..." />
                <button>Envoyer</button>
            </form>
    </main>
</div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const form = document.getElementById('form');
        const form2 = document.getElementById('form2');
        const form3 = document.getElementById('form3');
        const input = document.getElementById('input');
        const messages = document.getElementById('messages');
        const roomInput = document.getElementById('room');
        const publicInput = document.getElementById('publicMessage');
        const title = document.getElementById('title');
        const MDP = "PMEM44"
        const chuchoterInput = document.getElementById('chuchoterInput');
        const nameInput = document.getElementById('nameInput');
        const form4 = document.getElementById('form4');

        socket.emit("join_room", "CANAL GENERAL");

        // REJOINDRE UNE ROOM
        form2.addEventListener('submit', (e) => {
            e.preventDefault();
            if (roomInput.value) {
                socket.emit("join_room", roomInput.value);
                roomInput.value = '';
            }
        });

        //MESSAGE PUBLIC
        form3.addEventListener('submit', (e) => {
            e.preventDefault();
            if (publicInput.value) {
                if (publicInput.value.slice(0,6) == MDP){
                    socket.emit('send_to_all', publicInput.value);
                    publicInput.value = '';
                }
                else{
                    alert("VOUS N'AVEZ PAS LES DROITS")
                }
            }
        });

        // AFFICHER NOM SALLE
        socket.on("room_joined", (name) => {
            title.innerHTML = name;
            messages.innerHTML = "";
        });

        // ENVOYER UN MESSAGE
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            if (input.value) {
                socket.emit('chat message', input.value);
                input.value = '';
            }
        });

        //CHUCHOTER
        form4.addEventListener('submit', (e) => {
            e.preventDefault();
            if (chuchoterInput.value && nameInput.value) {
                const messageData = {
                    message: chuchoterInput.value,
                    user: nameInput.value,
                };
                socket.emit('chuchoter', messageData);
                chuchoterInput.value = '';
                nameInput.value = '';
            }
        });

        // RECEVOIR UN MESSAGE
        socket.on('chat message', (msg) => {
            const item = document.createElement('li');
            item.textContent = msg;
            messages.appendChild(item);
            window.scrollTo(0, document.body.scrollHeight);
            messages.scrollTop = messages.scrollHeight;
        });
    </script>
</body>
</html>